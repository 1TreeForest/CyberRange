<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="renderer" content="webkit" />
	<meta name="data-spm" content="a2ha1" />
	<title>皮皮虾资源网-专业资源分享网站</title>
	<meta name="keywords" content="资源,资源分享,资源搜索,资源发布" />
	<meta name="description" content="皮皮虾资源网是专业的资源分享网站,创建于2020年,包含资源下载、资源分享、原创博客、讨论区等产品服务,是一个提供原创、优质、完整内容的互联网资源分享平台." />
	<meta name="baidu-site-verification" content="code-A8GAwZFGBf" />
	<meta name="360-site-verification" content="5f121cfc336397840427006e464dafc2" />
	<link rel="shortcut icon" href="http://www.ppxzyw.com/favicon1.ico" type="image/x-icon" />
	<link rel="stylesheet" href="http://www.ppxzyw.com/css/style.css">
	<script src="http://www.ppxzyw.com/js/jquery-3.5.1.min.js"></script>
	<script src="http://www.ppxzyw.com/js/layer/layer.js"></script>
</head>
<body>
<div id="wrapper">
	<div id="list-header">
		<div class="container">
			<div class="logo">
				<a href="http://www.ppxzyw.com"><img src="/images/front/logo.png"><span style="color:#000;">皮皮虾资源网</span></a>
				<a href="http://www.ppxzyw.com/blog/list" style="line-height:45px;margin-left:20px;color:#666;">博客</a>
				<a href="http://www.ppxzyw.com/discuss" style="line-height:45px;margin-left:20px;color:#666;">讨论区</a>
				<a href="http://www.ppxzyw.com/manual" style="line-height:45px;margin-left:20px;color:#666;">编程手册</a>
				<a href="http://www.ppxzyw.com/video" style="line-height:45px;margin-left:20px;color:#666;">影视</a>
			</div>
				<div class="login"><a href="javascript:;" id="loginBtn">登录</a> / <a href="javascript:;" id="regBtn">注册</a></div>
		</div>
	</div>		<div id="content" class="index">
			<div class="logoArea"><img src="http://www.ppxzyw.com/images/front/logo.png" class="logo"><span class="webname">皮皮虾资源网</span></div>
			<div class="searchArea"><input type="" name="" class="searchInput" id="keyword" placeholder="搜索资源"><span class="searchButton" id="searchBtn">搜一搜</span></div>
			<div class="clear"></div>
		</div>
	<div id="index-footer">版权所有 © 2019-2021 皮皮虾资源网 <a style="color:#666" target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">晋ICP备2020014988号-2</a><script type="text/javascript" src="https://s4.cnzz.com/z_stat.php?id=1279577917&web_id=1279577917"></script></div>
</div>
<div class="dialog-wrapper" id="dialogWrapper"  style="display:none;">
	<div class="dialog-bg"></div>
	<div class="login-box" id="loginBox" style="display:none;">
		<div class="title">
			<span>用户登录</span>
			<a href="javascript:;" id="loginCloseBtn">×</a>
		</div>
		<div class="input">
			<input type="text" name="username" class="userName" id="loginAccount" placeholder="请输入邮箱"><br>
			<input type="password" name="password" class="password" id="loginPassword" placeholder="请输入密码">
		</div>
		<div class="tip" id="loginTip"></div>
		<div class="extra">
			<input type="checkbox" name="rember" checked="" id="loginRemember"><span class="checkbox">7天内免登录</span>
			<a href="javascript:;" id="findBtn">忘记密码</a>
		</div>
		<div class="loginBut">
			<button class="login" id="loginSubmitBtn">登录</button>
		</div>
		<div class="third_login">
			<a href="/wxLogin"><img src="/images/front/weixin.png"><span>微信登录</span></a>
		</div>
		<div class="info"><span>登录即代表同意<a href="/protocol" target="_blank">《用户服务协议》</a></span></div>
	</div>
	<style>
		.third_login{height: 30px;margin-top: 15px;}
		.third_login a{font-size: 12px;line-height: 32px;text-decoration: none;color: #999;width: 96px;height: 32px;float: left;z-index: 1;margin-left:100px;}
		.third_login a img{float: left;width: 32px;}
		.third_login a span{float: right;}
	</style>
	<!--注册框-->
	<div class="reg-box" id="regBox" style="display:none;">
		<div class="title">
			<span>用户注册</span>
			<a href="javascript:;" id="regCloseBtn">×</a>
		</div>
		<div class="input">
			<input type="text" name="username" class="userName" placeholder="请输入邮箱" id="regAccount"><br>
			<input type="text" name="verifyCode" class="verifyCode" placeholder="请输入验证码"  id="regCode"><button id="getCode">获取验证码</button>
			<input type="password" name="password" class="password" placeholder="请输入密码" placeholder="请输入密码（最少8位，数字+字母）" id="regPassword">
		</div>
		<div class="tip" id="regTip" style="display:none;"></div>
		<div class="info"><span>我已同意<a href="/protocol" target="_blank">《用户服务协议》</a></span></div>
		<div class="regBtn"><button id="regSubmitBtn">注册</button></div>
	</div>
	<!--找回密码框-->
	<div class="find-box" id="findBox" style="display:none;">
		<div class="title">
			<span>找回密码</span>
			<a href="javascript:;" id="findCloseBtn">×</a>
		</div>
		<div class="input">
			<input type="text" name="username" class="userName" placeholder="请输入邮箱" id="findAccount"><br>
			<input type="text" name="verifyCode" class="verifyCode" placeholder="请输入验证码" id="findCode"><button id="getCode2">获取验证码</button>
			<input type="password" name="password" class="password" placeholder="请输入密码" placeholder="请输入密码（最少8位，数字+字母）" id="findPassword">
		</div>
		<div class="tip" id="findTip" style="display:none;"></div>
		<div class="regBtn"><button id="findSubmitBtn">修改密码</button></div>
	</div>
</div>
<div class="chat-wrapper" id="chatWrapper" style="display:none;">
	<div class="chat-box" id="chatBox">
		<div class="title"><span style="display:inline-block;text-align:center;" id="chatNickname"></span><a href="javascript:;" id="chatCloseBtn">×</a>
		</div>
		<div class="messageList" id="messageList">
		</div>
		<div class="inputArea">
			<div class="toolbar">
				<svg style="display:none;" xmlns="http://www.w3.org/2000/svg" class="Zi Zi--Emotion EmoticonTool-icon ToolBar-Icon" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M7.523 13.5h8.954c-.228 2.47-2.145 4-4.477 4-2.332 0-4.25-1.53-4.477-4zM12 21a9 9 0 1 1 0-18 9 9 0 0 1 0 18zm0-1.5a7.5 7.5 0 1 0 0-15 7.5 7.5 0 0 0 0 15zm-3-8a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm6 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"></path></svg>
				<svg id="uploadImg" xmlns="http://www.w3.org/2000/svg" class="Zi Zi--AddImage ToolBar-Icon" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M13.25 5.5H6.868c-.755 0-1.368.613-1.368 1.368v10.264c0 .755.613 1.368 1.368 1.368h10.264c.755 0 1.368-.613 1.368-1.368V10.75H20v6.467A2.783 2.783 0 0 1 17.217 20H6.783A2.783 2.783 0 0 1 4 17.217V6.783A2.783 2.783 0 0 1 6.783 4h6.467v1.5zM8.158 13.4a1.033 1.033 0 0 1 1.744-.078l.258.37a.782.782 0 0 0 1.303-.031l1.332-2.113a1.173 1.173 0 0 1 2.01.043l2.03 3.537A1.25 1.25 0 0 1 15.748 17H8.25a1.252 1.252 0 0 1-1.085-1.873l.992-1.728zM9.5 11a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm3.75-5.5a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5zM18.5 4V2.25a.75.75 0 1 1 1.5 0V4h1.75a.75.75 0 1 1 0 1.5H20v1.75a.75.75 0 1 1-1.5 0V5.5h-1.75a.75.75 0 1 1 0-1.5h1.75zm.75 7.5a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5z"></path></svg>
				<input type="file" accept="image/png,image/jpeg" multiple="" class="UploadPicture-input" style="display:none;">
			</div>
			<textarea rows="6" cols="50" placeholder="" id="chatContent"></textarea>
			<div class="bottom"><button id="chatSendBtn">发送</button><span>按 Enter 键发送</span></div>
		</div>
	</div>
</div>
<script>
$(document).ready(function(){
	$("#avatarBtn").mouseenter(function(){
		$("#menu").show();
	});
	$("#avatarBtn").mouseleave(function(){
		$("#menu").hide();
	});
	$("#loginBtn").click(function(){
		$("#dialogWrapper").show();
		$("#loginBox").show();
	});
	function doLogin()
	{
		layer.load(2);
		$("#loginSubmitBtn").attr('disabled',"true");
		var remember=false;
		if($("#loginRemember").attr('checked'))remember=true;
		else remember=false;
		$.ajax({
			url:'/doLogin',
			data:{account:$("#loginAccount").val(),password:$("#loginPassword").val(),remember:remember},
			dataType:'json',
			success:function(data){
				console.log(data);
				if(data.code==200)
				{
					window.location.reload();
				}else{
					$("#loginTip").html(data.message);
				}
				$("#loginSubmitBtn").removeAttr("disabled");
				layer.closeAll('loading');
			},
			error:function(){
				console.log('出错');
			},
			//header:{c:300,d:400}
		});
	}
	$('#loginPassword').on('keypress',function(event){
        if(event.keyCode=='13')doLogin();
	});
	//登录提交按钮
	$("#loginSubmitBtn").click(function(){
		doLogin();
	});
	$("#loginCloseBtn").click(function(){
		$("#dialogWrapper").hide();
		$("#loginBox").hide();
	});
	//退出登录
	$("#logoutBtn").click(function(){
		layer.load(2);
		$.ajax({
		    url:'/logout',
			data:{},
			dataType:'json',
			success:function(data){
				console.log(data);
				if(data.code==200)
				{
					window.location="/";
				}else{
					layer.message(data.message);
				}
				layer.closeAll('loading');
			},
			error:function(){
				console.log('出错');
			},
			//header:{c:300,d:400}
		});
	});
	$("#regBtn").click(function(){
		$("#dialogWrapper").show();
		$("#regBox").show();
	});
	//注册部分获取验证码按钮
	$("#getCode").click(function(){
		layer.load(2);
		$("#getCode").attr('disabled',"true");
		$.ajax({
		    url:'/doGetCode',
			data:{account:$("#regAccount").val()},
			dataType:'json',
			success:function(data){
				console.log(data);
				if(data.code==200)
				{
					layer.msg(data.message);
				}else{
					$("#regTip").show();
					$("#regTip").html(data.message);
				}
				$("#getCode").removeAttr("disabled");
				layer.closeAll('loading');
			},
			error:function(){
				console.log('出错');
			},
		});
	});
	//注册提交按钮
	$("#regSubmitBtn").click(function(){
		layer.load(2);
		$("#regSubmitBtn").attr('disabled',"true");
		$.ajax({
		    url:'/doReg',
			data:{account:$("#regAccount").val(),code:$("#regCode").val(),password:$("#regPassword").val()},
			dataType:'json',
			success:function(data){
				console.log(data);
				if(data.code==200)
				{
					layer.msg(data.message);
					$("#dialogWrapper").hide();
					$("#regBox").hide();
				}else{
					$("#regTip").show();
					$("#regTip").html(data.message);
				}
				$("#regSubmitBtn").removeAttr("disabled");
				layer.closeAll('loading');
			},
			error:function(){
				console.log('出错');
			},
			//header:{c:300,d:400}
		});
	});
	$("#regCloseBtn").click(function(){
		$("#dialogWrapper").hide();
		$("#regBox").hide();
	});
	$("#findBtn").click(function(){
		$("#dialogWrapper").show();
		$("#findBox").show();
	});
	//找回密码部分获取验证码按钮
	$("#getCode2").click(function(){
		layer.load(2);
		$("#getCode2").attr('disabled',"true");
		$.ajax({
		    url:'/doGetCode',
			data:{account:$("#findAccount").val()},
			dataType:'json',
			success:function(data){
				console.log(data);
				if(data.code==200)
				{
					layer.msg(data.message);
				}else{
					$("#findTip").show();
					$("#findTip").html(data.message);
				}
				$("#getCode2").removeAttr("disabled");
				layer.closeAll('loading');
			},
			error:function(){
				console.log('出错');
			},
		});
	});
	//找回密码提交按钮
	$("#findSubmitBtn").click(function(){
		layer.load(2);
		$("#findSubmitBtn").attr('disabled',"true");
		$.ajax({
		    url:'/doFind',
			data:{account:$("#findAccount").val(),code:$("#findCode").val(),password:$("#findPassword").val()},
			dataType:'json',
			success:function(data){
				console.log(data);
				if(data.code==200)
				{
					layer.msg(data.message);
					$("#dialogWrapper").hide();
					$("#findBox").hide();
				}else{
					$("#findTip").show();
					$("#findTip").html(data.message);
				}
				$("#findSubmitBtn").removeAttr("disabled");
				layer.closeAll('loading');
			},
			error:function(){
				console.log('出错');
			},
			//header:{c:300,d:400}
		});
	});
	$("#findCloseBtn").click(function(){
		$("#dialogWrapper").hide();
		$("#findBox").hide();
	});
	$("#searchBtn").click(function(){
		window.location.href="/list?keyword="+encodeURIComponent($("#keyword").val());
	});
	//input 绑定回车按键
	$('#keyword').on('keypress',function(event){
		if(event.keyCode=='13'){
			/*if($("#keyword").val().length==0)return;
			else*/window.location.href="/list?keyword="+encodeURIComponent($("#keyword").val());
		}
	});
	$("#searchBtn2").click(function(){
		/*if($("#keyword2").val().length==0)return;
		else*/window.location.href="/list?keyword="+encodeURIComponent($("#keyword2").val());
	});
	//input 绑定回车按键
	$('#keyword2').on('keypress',function(event){
		if(event.keyCode=='13'){
			/*if($("#keyword2").val().length==0)return;
			else*/window.location.href="/list?keyword="+encodeURIComponent($("#keyword2").val());
		}
	});
	$(".deleteResource").click(function(){
		var id=$(this).attr("id");
		layer.confirm("确定删除该资源吗，删除后将不可恢复", {btn: ['确定', '取消'], title: "提示"}, function () {
			layer.load(2);
			$.ajax({
				type: "post",
				url: "/user/resource/doDelete?id="+id,
				data: null,
				dataType: "json",
				async: false,
				success: function (data) {
					if (data.code == 200) {
						layer.msg(data.message, {icon: 1});
						window.location.reload();
					} else {
						layer.msg(data.message, {icon: 2});
					}
					layer.closeAll('loading');
				}
			});
		});
	});
	//聊天部分
	$("#chatCloseBtn").click(function(){
		$("#chatWrapper").hide();
		$("#chatBox").hide();
	});

	var tmpUid=0;
	var tmpAvatar="";
	var tmpNickname="";
	function registerPageEvent()
	{
		$(".page .pageNumber").click(function(){
			var page=$(this).attr("page");
			showChat(page);
		});
		$("#listPageJump2").on('keypress',function(event){
			if(event.keyCode=='13'){
				var total=$("#listPageJump2").attr("total");
				var page=$('#listPageJump2').val();
				if(page>0&&page<=total)showChat(page);
			}
		});
	}
	function showChat(page)
	{
		$("#chatBox").attr("uid",tmpUid);
		$("#messageList").html("");
		layer.load(2);
		$.get("/discuss/isLogin",{},function(data){
			if(data.code==200){
				$("#chatWrapper").show();
				$("#chatBox").show();
				$("#chatNickname").html(tmpNickname);
				//加载消息列表
				$.get("/discuss/loadChat",{toId:tmpUid,pageNo:page},function(data){
					if(data.code==200){
						console.log(data.result.records);
						$("#messageList").append(data.page);
						for(var i=0;i<data.result.records.length;i++)
						{
							var item=data.result.records[i];
							$("#messageList").append("<div class=\"timeItem\">"+item.createTime+"</div>");
							var html="";
							if(item.uid==tmpUid)
							{
								html="<div class=\"messageItem\">"+
									"<a class=\"avatar\" href=\"/resource/user?uid="+item.uid+"\" target=\"_blank\"><img src=\""+tmpAvatar+"\"></a>"+
									"<div class=\"messageContent\">"+item.content+"</div><div class=\"clear\"></div></div>";
							}else{
								html="<div class=\"messageItem my\">"+
									"<a class=\"avatar\" href=\"/resource/user?uid=\" target=\"_blank\"><img src=\"\"></a>"+
									"<div class=\"messageContent\">"+item.content+"</div><div class=\"clear\"></div></div>";
							}
							$("#messageList").append(html);

						}
						var container = document.getElementById("messageList");
						container.scrollTop = container.scrollHeight;
						registerPageEvent();
					}
				},"json");
			}else{
				//layer.msg(data.message);
				//没登录显示登陆对话框
				$("#dialogWrapper").show();
				$("#loginBox").show();
			}
			layer.closeAll('loading');
		},"json");
	}
	$(".chat ul li").click(function(){
		$("#chatWrapper").show();
		$("#chatBox").show();
		tmpUid=$(this).attr("uid");
		tmpAvatar=$(this).attr("avatar");
		tmpNickname=$(this).attr("nickname");
		showChat(0);
	});

	$(".chatBtn").click(function(){
		var obj=$(this);
		layer.load(2);
		$.get("/discuss/isLogin",{},function(data){
			if(data.code==200){
				tmpUid=$(obj).attr("uid");
				tmpAvatar=$(obj).attr("avatar");
				tmpNickname=$(obj).attr("nickname");
				$("#chatWrapper").show();
				$("#chatBox").show();
				showChat(0);
			}else{
				//没登录显示登陆对话框
				$("#dialogWrapper").show();
				$("#loginBox").show();
			}
			layer.closeAll('loading');
		},"json");
	});

	function sendMessage(content)
	{
		$.post("/discuss/doChat",{toId:$("#chatBox").attr("uid"),content:content},function(data){
			if(data.code==200){
				$("#messageList").append("<div class=\"timeItem\">"+data.result+"</div>");
				var html="<div class=\"messageItem my\">"+
							"<a class=\"avatar\"><img src=\"\"></a>"+
							"<div class=\"messageContent\">"+content+"</div><div class=\"clear\"></div></div>";
				$("#messageList").append(html);
				var container = document.getElementById("messageList");
				container.scrollTop = container.scrollHeight;
				$("#chatContent").val("");
			}else{
				layer.msg(data.message);
			}
			layer.closeAll('loading');
		},"json");
	}
	$("#chatSendBtn").click(function(){
		sendMessage($("#chatContent").val());
	});
	$('#chatContent').on('keypress',function(event){
		if(event.keyCode=='13'){
			sendMessage($("#chatContent").val());
		}
	});
	$(".UploadPicture-input").change(function(){
		layer.load(2);
		var file = this.files[0];
		console.log(file.type);
		var formData = new FormData();
		formData.append("file",this.files[0]);
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function() {
			if (xhr.readyState === 4 && xhr.status === 200) {
				console.log(xhr.responseText);
				const response  = JSON.parse(xhr.responseText);
				if (response.code==200) {
					var filename=response.result;
					sendMessage("<img src=\""+filename+"\"/>");
				} else {
					layer.msg(response.message);
				}
				layer.closeAll('loading');
			}
		};
		xhr.upload.addEventListener("progress", function(event) {
			if(event.lengthComputable){
				console.log("width is:"+Math.ceil(event.loaded * 100 / event.total) + "%");
			}
		}, false);
		xhr.open("POST", "/discuss/chatImageUpload");
		xhr.send(formData);
	});
	$("#uploadImg").click(function(){
		$(".UploadPicture-input").click();
	});
});
</script>
</body>
</html>