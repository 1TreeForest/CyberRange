<!DOCTYPE html>

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>智慧课堂</title>
<link rel="stylesheet" type="text/css" href="/res/css/daping/global.css?v=2022022824" />
<link rel="stylesheet" type="text/css" href="/res/css/daping/cxPublic.css?v=2022022824" />
<link rel="stylesheet" type="text/css" href="/res/css/daping/style.css?v=2022022824" />
<script src="/res/js/jquery-1.10.2.min.js"></script>
<script src="/res/js/rem750.js"></script>
<script src="/res/js/fullScreen.js" type="text/javascript" charset="utf-8"></script>
<script src="/service-domain/serviceDomainScript?DB_STRATEGY=RANDOM"></script>
<script type="text/javascript">
/* <![CDATA[  */
	var appId = 0 || 0;
	if(appId == 1000161||appId == 1000130){
		cef.closeScreen();//智慧课堂和智慧教室客户端，退出投屏进入投屏码输入页面时，这里执行关闭页面，使用客户端的界面
	}
	
	var n = "1";
    testSupportWebsocket();
	$(function(){
		$(".clearfix li input").focus(function(){
			$(this).parent().addClass("current");
			n = $(this).attr("codeIndex");
		});
		$(".clearfix li input").blur(function(){
			$(this).parent().removeClass("current");
		});
		$(".clearfix li input").keydown(function(e){
			var keyCode=parseInt(e.keyCode);window.console && console.log("keyCode="+keyCode);
			$(this).val('');
			if(keyCode==8){
				var codeIndex=parseInt($(this).attr("codeIndex"));
				if(codeIndex>1){
					$(".clearfix li input[codeIndex='"+(codeIndex-1)+"']").focus();
				}
			}
		});
		$(".clearfix li input").bind("input propertychange",validateInput);
		
		$(".clearfix li input[codeIndex='1']").focus();
	});
	
	function deleteCode(){
		
	}
	
	var lastInputTime=0;
	function validateInput(e){
		var nowTime=new Date().getTime();
		if((nowTime-lastInputTime)<20){
			lastInputTime=nowTime;
			return false;
		}
		var s=$(this).val();
		//s=s.replace(/[^\d]/g,'');
		if(s.length>1){
			s=s.substring(0,1);
		}
		var re = /[0-9]/;
		if(!re.test(s)){
			s='';
		}
		if(s.length<=0){
			$(this).val('');
		}else{
			$(this).val(s);
			var codeIndex=parseInt($(this).attr("codeIndex"));
			if(codeIndex<4){
				$(".clearfix li input[codeIndex='"+(codeIndex+1)+"']").focus();
			}else{
				$(".clearfix li input[codeIndex='"+codeIndex+"']").blur();
				commitCode();
			}
		}
		lastInputTime=nowTime;
		return false;
	}
	
	function commitCode(){
		var connectCode="";
		connectCode=connectCode+$(".clearfix li input[codeIndex='1']").val();
		connectCode=connectCode+$(".clearfix li input[codeIndex='2']").val();
		connectCode=connectCode+$(".clearfix li input[codeIndex='3']").val();
		connectCode=connectCode+$(".clearfix li input[codeIndex='4']").val();
		if(connectCode.length<4){
			$(".clearfix li input[codeIndex='1']").focus();
			$("#errormsg").text("投屏码无效");
		}else{
			$("#connectCode").val(connectCode);
			validateCode(connectCode);
		}
	}
	
	//校验投屏码
	function validateCode(code){
		var url="/apis/toScreen/isCodeValid?connectCode="+code;
		$.ajax({
   			url: url,
        	type: "get",
   			dataType:"json",
	   		success:function(json){//console.log(JSON.stringify(json));
	   			if(json.result==1){
	   				if(json.data==1){
	   					$("#clientTime").val(new Date().getTime());
	   					document.forms[0].submit();
	   				}else{
	   					$("#connectCode").val("");
	   					$(".clearfix li input").val("");
	   					$(".clearfix li input[codeIndex='1']").focus();
	   					$("#errormsg").text(json.msg);
	   				}
	   			}else{
	   				$("#errormsg").text(json.errorMsg);
	   			}
			}
		});
	}

	/**
	 * 检测浏览器是否支持websocket
	 */

	function testSupportWebsocket() {
        var iebroser = isIEBrowser();//判断是否是ie浏览器并返回浏览器版本
        if(iebroser!="undefined"&&(iebroser>=6&&iebroser<9)){//不支持IE9以下浏览器
    		window.location.href = "/notSupportWebsocket?webBrowserType=0";
    		return;
    	}
		if(iebroser!="undefined"&&iebroser==9){//放过IE9浏览器
			return;
		}
        if (typeof (navigator.vendor) != "undefined") {
            if (navigator.vendor.indexOf("Apple") == -1&&typeof(window.WebSocket) != "function") {//为非safari浏览器  不检测是不是支持webSocket
                window.location.href = "/notSupportWebsocket?webBrowserType=0";
            }
            
        } else if (typeof(window.WebSocket) != "function") {//ie浏览器没有navigator.vendor这个值
            window.location.href = "/notSupportWebsocket?webBrowserType=0";
        }
    }
    //判断是否是IE浏览器并返回IE浏览器版本
    function isIEBrowser(){
        var userAgent = navigator.userAgent;
        var isIE = userAgent.indexOf("compatible") > -1 && userAgent.indexOf("MSIE") > -1;//判断是否IE<11浏览器
        var isEdge = userAgent.indexOf("Edge") > -1 && !isIE; //判断是否IE的Edge浏览器
        var isIE11 = userAgent.indexOf('Trident') > -1 && userAgent.indexOf("rv:11.0") > -1;
        if(isIE) {
            var reIE = new RegExp("MSIE (\\d+\\.\\d+);");
            reIE.test(userAgent);
            var fIEVersion = parseFloat(RegExp["$1"]);
            if(fIEVersion == 7) {
                return 7;
            } else if(fIEVersion == 8) {
                return 8;
            } else if(fIEVersion == 9) {
                return 9;
            } else if(fIEVersion == 10) {
                return 10;
            } else {
                return 6;//IE版本<=7
            }
        } else if(isEdge) {
            return 'edge';//edge
        } else if(isIE11) {
            return 11; //IE11
        }else{
            return -1;//不是ie浏览器
        }
	}
	
	function fullScreen(){
		requestFullScreen(document.documentElement);
		$("#fullScreenBtn").hide();
	    $("#exitFullBtn").show();
	}

	function exitfullScreen(){
		exitFull();
		$("#fullScreenBtn").show();
	    $("#exitFullBtn").hide();
	}
	
	function focusInputCodes(){
		$(".clearfix li input[codeIndex='"+n+"']").focus();
	}
	
	function toPassport(){
		/*var protocol=window.location.protocol;
		if(protocol.indexOf("https:")>=0) {
			protocol="https";
		}else {
			protocol="http";
		}*/
		var backUrl=ServiceDomain.xxtClassDomainWithProtocol+"/course/begin2daping?k=1";
		location.href=ServiceDomain.passportDomainWithProtocol+"/screenscanlogin?backUrl="+encodeURIComponent(backUrl);
	}
/* ]]> */      
</script>
</head>
<body onclick="focusInputCodes()" class="cx_bgpng" style="background: #1b1a39 url(/res/images/body_bd.png) no-repeat center bottom; background-size: 100% auto;">
	
	<div class="codes_box">
		<div class="codes_content">
			<h2 class="input_title_h2">请输入手机上的投屏码</h2>
			<div class="input_size">
				<ul class="clearfix">
					<li class="current"><input type="text" codeIndex="1" /></li>
					<li><input type="text" codeIndex="2" /></li>
					<li><input type="text" codeIndex="3" /></li>
					<li><input type="text" codeIndex="4" /></li>
				</ul>
			</div>
			<div class="codes_error">
				<div id="errormsg"></div>
				<!-- 显示隐藏此div -->
			</div>
		</div>
	</div>
	
	<div class="temporary_have">
		<a class="temporary_href" href="javascript:void(0)" onclick="toPassport()">登录</a>
		<!-- <span class="temporary_line">|</span>
		<a class="temporary_href" href="#">临时上课</a> -->
	</div>

	<!-- <a id="fullScreenBtn" class="fullScreen cx_color_white" style="z-index: 9999;" onclick="fullScreen()">全屏</a>
	<a id="exitFullBtn" class="exitFull cx_color_white" style="z-index: 9999;display: none;" onclick="exitfullScreen()">退出全屏</a> -->

	<form action="/course/login" method="post">
		<input type="hidden" id="clientTime" name="clientTime" />
		<input type="hidden" id="connectCode" name="connectCode" />
		<input type="hidden" name="test" value="0" />
		
	</form>
</body>









</html>
