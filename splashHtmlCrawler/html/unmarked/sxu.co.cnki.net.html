<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="ie=edge,Chrome=1">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate, no-store">
    <meta http-equiv="expires" content="0">
    <meta name="format-detection" content="telephone=no" />
    <!--<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />-->
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="Bookmark" href="favicon.ico" />
    <link rel="stylesheet" href="Themes/default/easyui.css?r=2022011708455156" />
    <link rel="stylesheet" href="Themes/default/Login.css?r=2022011708455156" />
    <link rel="stylesheet" href="Themes/default/chosen.min.css?r=2022011708455156" />
    <script type="text/javascript" src="Scripts/jquery.min.js?r=2022011708455156"></script>
    <script type="text/javascript" src="Scripts/jquery.cookie.js?r=2022011708455156"></script>
    <script type="text/javascript" src="Scripts/jquery.easyui.min.js?r=2022011708455156"></script>
    <script type="text/javascript" src="Scripts/common.js?r=2022011708455156"></script>
    <script type="text/javascript" src="Scripts/login2hs.js?r=2022011708455156"></script>
    <script type="text/javascript" src="Scripts/JSEncrypt.js?r=2022011708455156"></script>
    <script type="text/javascript" src="Scripts/Q2L.js?r=2022011708455156"></script>
    <script type="text/javascript" src="Scripts/clipboard.min.js?r=2022011708455156"></script>
    <script type="text/javascript" src="Scripts/chosen.jquery.min.js?r=2022011708455156"></script>
    <script type="text/javascript" src="Scripts/Login.js?r=2022011708455156"></script>

    <!--[if lt IE 9]>
        <script type="text/javascript" src="../Scripts/json2.js?r=2022011708455156"></script>
        <script type="text/javascript" src="../Scripts/jquery-1.9.1.min.js?r=2022011708455156"></script>
    <![endif]-->
    <title>大学生毕业设计（论文）管理系统</title>
    <style>
        #meetingRemindBox {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            z-index: 999 !important;
            display: none;
        }

        .meetingRemind {
            width: 586px;
            height: 496px;
            position: absolute;
            left: 50%;
            top: 50%;
            margin-top: -248px;
            margin-left: -293px;
            background: url('./Themes/default/images/modal_bg.png') no-repeat 0 0;
            font-size: 14px;
            line-height: 22px;
            color: #000;
        }

            .meetingRemind .close {
                width: 24px;
                height: 24px;
                position: absolute;
                right: 22px;
                top: 20px;
                /*background: #f00;*/
                border-radius: 12px;
                cursor: pointer;
            }

                .meetingRemind .close:hover {
                    background: rgba(0,0,0,0.2);
                }

            .meetingRemind .title {
                line-height: 24px;
                font-size: 14px;
                font-weight: 700;
                color: #fd792f;
            }

        .meetingTitle, .meetingLive, .meetingTime, .meetingCompany {
            position: absolute;
            left: 40px;
            top: 110px;
            width: 420px;
            height: 136px;
            overflow: hidden;
        }

        .meetingTime {
            top: 250px;
            height: 46px
        }

        .meetingLive {
            top: 300px;
            height: 70px;
        }

            .meetingLive .copyTips {
                position: absolute;
                left: 237px;
                top: 47px;
                width: 60px;
                height: 22px;
                color: #fff;
                background: rgba(0,0,0,0.6);
                border-radius: 10px;
                text-align: center;
                line-height: 22px;
            }

            .meetingLive a:hover {
                text-decoration: underline;
            }

            .meetingLive input[type=button] {
                background: #fd792f;
                color: #fff;
                border-radius: 20px;
                padding: 2px 8px;
                font-size: 12px;
                vertical-align: text-bottom;
                margin-left: 5px;
            }

        .meetingCompany {
            top: 375px;
            color: #666;
            font-family: '宋体';
            font-size: 12px;
        }

        .chosen-container-single .chosen-single {
            height: 38px;
            line-height: 38px;
            border-color: #e8e8e8;
        }

            .chosen-container-single .chosen-single div {
                top: 7px;
            }

        #loginLoddingBox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('Themes/default/images/loginLodding.jpg') no-repeat 0 0;
            background-color: #fff;
            background-size: cover;
            background-position: center 0;
            z-index: 101;
            display: none;
        }
    </style>
</head>

<body>
    <div id="ie_versions" style="text-align:center;background-color:orange;display:none;">
        <h3>您的ie浏览器版本过低，请进行升级。</h3>
    </div>
    <div id="login_main" style="width:0 !important;height:0 !important;overflow:hidden !important;">
        <div id="pcShow">
            <div class="loginBox">
                <div class="loginTop">
                    <div class="noticeOrDownLoad">
                        <a class="notifications" href="javascrit:void(0);"><i></i> 微信消息提醒 </a>
                        <p class="weixindigg">
                            <i class="sanjiao_down"></i>
                            <img src="Themes/default/images/weixindigg.jpg" alt="Alternate Text" width="120" />
                            <br />
                            <span>扫一扫关注</span>
                        </p>
                        <a class="downloadAPP" href="http://co.cnki.net" target="_blank"><i></i> APP下载 </a>
                    </div>
                    <p class="login-college">
                        <img id="school_logo" class="banner-school-img" src="" alt="" />
                        <span id="school_name" style="display:none;"></span>
                    </p>
                    <p class="login-paper" id="xtmc"></p>
                </div>
                <!--中间部分-->
                <div class="brief clearfix">
                    <!--公告 下载 。。4个盒子-->
                    <div id="divNotice" class="bulletin-board clearfix"></div>
                    <!--登录窗口-->
                    <div class="PasswordBox">
                        <ul class="switcher clearfix">
                            <li class="active">账号密码登录</li>
                            <li style="margin-left: 10px;">已绑定微信登录</li>
                        </ul>
                        <div class="longinBox">
                            <ul class="write switch" style="display: block;" id="write">
                                <!--<li class="title">账号密码登录</li>-->
                                <li style="margin-top: 7px;">
                                    <span>
                                        &nbsp;&nbsp;
                                        账号类型：
                                    </span>
                                    <span id="rolebox">
                                        <span class="roleSpan" data-id="1">管理员</span>
                                        <span class="roleSpan active" data-id="2">教师</span>
                                        <span class="roleSpan" data-id="3">学生</span>
                                    </span>
                                    <!--<span id="rolebox">
                                        <span class="mgl"><input type="radio" id="rdoAdmin" name="usertype" value="1" />&nbsp;<label for="rdoAdmin"></label>管理员</span>
                                        <span class="mgl"><input type="radio" id="rdoTea" name="usertype" checked="checked" value="2" />&nbsp;<label for="rdoTea"></label>教师</span>
                                        <span class="mgl"><input type="radio" id="rdoStu" name="usertype" value="3" />&nbsp;<label for="rdoStu"></label>学生</span>
                                    </span>-->
                                </li>
                                <li>
                                    <i class="usericon"></i><input id="username" class="user" type="text" autofocus placeholder="请输入用户名" maxlength='30' />
                                </li>
                                <li>
                                    <i class="pswdicon"></i><input id="password" class="pswd" type="password" placeholder="输入密码" maxlength='30' />
                                </li>
                                <li style="height: auto;" class="phoneLoginShow disNone">
                                    <input type="hidden" id="phone_prefix_txt" isShow="0" value="China" />
                                    <select id="phone_prefix" class="chosen-select" style="width: 125px; height: 36px; display: none;" data-placeholder="输入检索或点击右侧下拉"></select>
                                    <i class="phoneIcon"></i>
                                    <input id="phoneText" class="phoneText" type="text" placeholder="请输入正确的手机号" autocomplete="off" style="width: 140px;" maxlength='11' />
                                    <p id="noPhoneTips" style="color: #f00; font-size: 12px; line-height: 1.8em; display: none;">您当前登录的账号没有绑定手机号，当前手机号验证成功后会自动绑定此手机号</p>
                                    <p id="identifying_tipsTxt" style="color: #22a049; font-size: 12px; line-height: 1.8em; display: none;"></p>
                                </li>
                                <li class="phoneLoginShow disNone">
                                    <i class="verifiericon"></i>
                                    <input id="checkcode" class="verifier" type="text" placeholder="请输入手机验证码" maxlength='6' autocomplete="off" />
                                    <input type="button" id="getPhoneCode" class="phoneCode" name="name" value="获取验证码" />
                                </li>
                                <li class="checkcodeLoginShow disNone">
                                    <i class="verifiericon"></i>
                                    <input id="imgCheckcode" class="imgCheckcode" type="text" placeholder="请输入验证码" maxlength='5' autocomplete="off" />
                                    <!--<span class="space"></span>-->
                                    <img id="checkcode_img" class="verifier-code checkcode_img" src="" style="height: 34px;" onclick="load_checkcode()" alt="验证码" title="请将图中的数字或者字母填写到左边的输入框中，如果看不清楚，请点击图片更换" />
                                </li>
                                <li class="clearfix" style="margin-top: 3px;">
                                    <input id="login" class="btn" onclick="login_click();" type="button" value="登录" />
                                    <a class="resetPwd" id="resPwd" href="ResetPasswords.html">忘记密码？</a>
                                </li>
                                <li class="bottomTips clearfix">
                                    <div style="text-align: center;">
                                        <img src="Themes/default/images/weixin_ewm.jpg" width="110" alt="科研诚信" title="科研诚信" />
                                        <p>扫一扫关注我们</p>
                                        <p style="color: #333;">
                                            <img src="Themes/default/images/sge_eml_ui.gif" alt="邮箱" title="邮箱" />
                                            amlc@cnki.net
                                        </p>
                                    </div>
                                </li>
                            </ul>
                            <ul class="switch  WeChat" style="display: none;">
                                <li class="QRcode_box" id="login_QRcode"></li>
                                <li class="WeChatTips">
                                    <p>请使用已经绑定的微信号，<b>扫一扫 </b>登录系统</p>
                                    <p>还未将账号与微信号进行绑定，请先使用账号密码登录系统进行绑定后使用<a id="switchToWrite" href="javascript:;" title="账号密码登录">切换账号密码登录</a></p>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!--尾部-->
            <div style=" border-top: 1px solid #bac4cd; background-color: #f4f4f4;">
                <div class="footer clearfix">
                    <div class="logimg-box">
                        <img class="cnki" src="./Themes/default/images/Logomin1103.png">
                    </div>
                    <div class="logtext-box">
                        <p>
                            <span>京ICP证040431号&nbsp;&nbsp;<!--<a class="black" href="http://piccache.cnki.net/index/images/gb/271.jpg" target="_blank">-->网络出版服务许可证（总）网出证（京）字第271号<!--</a>--></span>&nbsp;&nbsp;
                            <span><!--<a class="black" href="http://www.hd315.gov.cn/beian/view.asp?bianhao=010202005012100021" target="_blank">-->经营性网站备案信息<!--</a>--> 京公网安备 11010802020460号</span>
                        </p>
                        <p><span>© 2016-<span id="nowyear">2020</span> 中国知网（CNKI）《中国学术期刊（光盘版）》电子杂志社有限公司</span></p>
                        <!--<p class="margt">
                            <a class="badge" href="https://ss.knet.cn/verifyseal.dll?sn=e13111111010043364isll000000&a=1&pa=0.08881110103584755" target="_blank">
                                <img width="86" height="33" alt="可信网站" src="Themes/default/images/kxwzz.png">
                            </a>-->
                        <!--<a href="https://credit.cecdc.com/CX20140929005220005306.html" target="_blank">
                            <img width="86" height="33" alt="诚信网站" src="Themes/default/images/cert.jpg">
                        </a>-->
                        <!--</p>-->
                    </div>
                </div>
            </div>
        </div>
        <div id="mobileShow" style="display: none;">
            <div class="mobileSchoolInfo">
                <p class="switchover"><a id="switchPC" href="javascript:;"><< 返回电脑版</a></p>
                <p class="schoolName">
                    <img id="mSchoolLogo" src="" alt="" style="display: none;" />
                    <span id="mSchoolName" style="display: none"></span>
                </p>
                <p class="systemName" id="mSystemName">
                    大学生毕业设计管理系统
                </p>
            </div>
            <div class="mobileLoginBox">
                <p>
                    账号类型：
                    <span id="mobileRole">
                        <span class="roleSpan" data-id="1">管理员</span>
                        <span class="roleSpan" data-id="2">教师</span>
                        <span class="roleSpan" data-id="3">学生</span>
                    </span>
                </p>
                <p class="namePwd">
                    <i></i>
                    <input type="text" id="mobileName" name="" value="" placeholder="请输入用户名" maxlength='30' />
                </p>
                <p class="namePwd pwd">
                    <i></i>
                    <input type="password" id="mobilePwd" name="" value="" placeholder="请输入密码" maxlength='30' />
                </p>
                <p style="height: auto;" class="phoneBox phoneLoginShow disNone">
                    <input type="hidden" id="mobilephone_prefix_txt" isShow="0" value="China" />
                    <select id="mobilephone_prefix" data-placeholder="点击右侧下拉"></select>
                    <i class="phoneIcon"></i>
                    <input id="mobilephoneText" class="phoneText" type="text" style="width: 70%;" placeholder="请输入正确的手机号" autocomplete="off" maxlength='11' />
                </p>
                <div style="position: relative; top: -30px;" class="phoneLoginShow disNone">
                    <div id="mobilenoPhoneTips" style="color: #f00; font-size: 24px; line-height: 1.8em; display: none;">
                        您当前登录的账号没有绑定手机号，当前手机号验证成功后会自动绑定此手机号
                    </div>
                    <div id="mobileidentifying_tipsTxt" style="color: #22a049; font-size: 24px; line-height: 1.8em; display: none;"></div>
                </div>
                <p class="verificationCode phoneLoginShow disNone">
                    <i></i>
                    <input type="text" id="mobileCode" name="" value="" placeholder="请输入验证码" maxlength='6' autocomplete="off" />
                    <input type="button" id="getmobilePhoneCode" name="name" value="获取验证码" />
                </p>
                <p class="verificationCode checkcodeLoginShow disNone">
                    <i></i>
                    <input type="text" id="mobileimgCheckcode" name="" value="" placeholder="请输入验证码" maxlength='5' autocomplete="off" />
                    <img id="mobileVerificationCode" class="checkcode_img" src="" onclick="load_checkcode()" alt="验证码" title="请将图中的数字或者字母填写到左边的输入框中，如果看不清楚，请点击图片更换" />
                </p>
                <p class="loginBtn">
                    <input type="button" id="mLoginBtn" name="loginBtn" value="登录" onclick="login_click(1)" />
                </p>
            </div>
            <div class="mobileNotice" id="mobileNotice"></div>
        </div>
    </div>
    <div id="no_main" style="display:none;background-color:#daeff4;width:100%;height:100%;">
        <div style="background-image: url('Themes/default/images/no_01.jpg'); margin: 100px auto;  width: 512px; height: 437px;"></div>
    </div>
    <div id="wait_main">
        <div style="width:200px;height:200px;margin:auto; margin-top:50px;">
            <img src="Themes/default/images/load.gif" alt="" title="" />正在加载数据
        </div>
    </div>
    <div id="loginLoddingBox"></div>
    <!--<div id="brower" class="browerTipsBox">
        <div class="browerTips">
            <a class="closedBtn" href="javascript:;" onClick="closeBrowserTips()">x</a>
            <p style="color:#eb0707;font-size:22px;margin: 20px 0; line-height: 26px;">
                获得更方便安全的使用体验，建议使用以下浏览器：火狐FireFox、谷歌Chrome等高版本浏览器（请选择“极速”或“高速”模式）。不支持IE8及以下浏览器。-->
    <!--为使您获得更安全、更快速以及更优质的体验，建议使用以下浏览器：火狐FireFox、谷歌Chrome等高版本浏览器（请选择“极速”或“高速”模式）；不支持IE8及以下浏览器。-->
    <!--</p>
            <p style="color:#333;font-size:16px; margin-bottom: 10px;">
                建议下载：
                <a style="margin-right:70px;" href="http://www.firefox.com.cn/" target="_blank">
                <img class="vam mr5" src="/Themes/default/images/firfox.png" />
                    火狐浏览器
                </a>
                <a href="https://www.google.cn/chrome/" target="_blank">
                    <img class="vam mr5" src="/Themes/default/images/google.png" />
                    谷歌浏览器
                </a>
            </p>
            <p style="color:#333;font-size:16px; margin-bottom: 20px;">
                <input type="checkbox" id="notTips" name="notTips" value="1" />
                <label for="notTips" style="color:#eb0707;">不再提示</label>
            </p>
        </div>
    </div>-->
    <!--<div style="width:0px;height:0px;overflow:hidden;">
        <div id="meetingRemindBox">
            <div class="meetingRemind">
                <div class="close" onclick="closeMeetingRemindBox()"></div>
                <div class="meetingTitle">
                    <div class="title"> 会议议题： </div>
                    <p>1、线上线下混合式实践课程建设案例</p>
                    <p>2、社会实践一流课程建设案例</p>
                    <p>3、混合式教学模式应用于本科生毕业设计（论文）工作</p>
                    <p>4、混合式教学模式应用于工科专业实践课程体系</p>
                    <p>5、混合式教学模式应用于高校工科实践教育体系</p>
                </div>
                <div class="meetingTime">
                    <div class="title"> 会议时间： </div>
                    <strong>11月22日8:30-17:00</strong>   议程安排扫码查看
                </div>
                <div class="meetingLive">
                    <div class="title"> 直播网址： </div>
                    <strong> 知网在线教学平台</strong>
                    <p>
                        <a href="https://k.cnki.net/CInfo/Index/10993" style="color: #000;" target="_blank">
                            <strong>
                                https://k.cnki.net/CInfo/Index/10993
                            </strong>
                        </a>
                        <input type="button" id="meetingLiveTxt" name="name" value="复制" data-text="https://k.cnki.net/CInfo/Index/10993" onclick="meetingLiveCopy()" />
                    </p>
                </div>
                <div class="meetingCompany">
                    <p>
                        <span>主办单位：</span>
                        <span>同济大学本科生院</span>
                        <br />
                        <span style="margin-left: 66px;">中国知网</span>
                    </p>
                    <p>
                        <span>协办单位：</span>
                        <span>广东省高等学校教学管理学会实践教学管理专业委员会</span>
                        <br />
                        <span style="margin-left: 66px;">江苏省高等学校教学管理研究会实践教学工作委员会</span>
                    </p>
                </div>
            </div>
        </div>
    </div>-->
    <script>
        var isfirst = true;
        var baseUrl = '';
        $(function () {
            if (getUrlIsMultistage()) {
                baseUrl = '/' + getUrlIsMultistage() + '/';
            }
            var mobile_flag = isMobile();
            if (mobile_flag) {
                $("#mobileShow").show();
                $("#pcShow").hide();
            } else {
                $("#pcShow").show();
                $("#mobileShow").hide();
            };
            if (IEVersion() == 7 || IEVersion() == 6) {
                LoginMessage('您的ie浏览器版本过低，请升级您的浏览器');
                document.getElementById("ie_versions").style.display = "block";
            };
            $("#rolebox,#mobileRole").off("click").on("click", '.roleSpan', function () {
                if (isShowPhoneLogin[$(this).attr('data-id') - 1] == 1) {
                    $(".phoneLoginShow").removeClass('disNone');
                    $(".checkcodeLoginShow").addClass('disNone');
                } else {
                    $(".phoneLoginShow").addClass('disNone');
                    var isImg = mobile_flag ? $("#mLoginBtn").attr("data-img") : $("#login").attr("data-img");
                    if (isImg == '1') {
                        $(".checkcodeLoginShow").removeClass('disNone');
                    } else {
                        $(".checkcodeLoginShow").addClass('disNone');
                    }
                }
                $(this).addClass("active").siblings().removeClass("active");
                $("#identifying_tipsTxt,#noPhoneTips,#mobileidentifying_tipsTxt,#mobilenoPhoneTips").hide();
                $("#login,#mLoginBtn").attr('data-type', isShowPhoneLogin[$(this).attr('data-id') - 1] == 1 ? 1 : 0);
            });


            //if (!$("#pcShow").is(":hidden")) {
            //    var isBrowserTips = window.localStorage.getItem("closebrowsertips");
            //    if (isBrowserTips == 1 || checkBrowser() == "谷歌" || checkBrowser() == "火狐") {
            //        $("#brower").hide();
            //    } else {
            //        $("#brower").show();
            //    }
            //}
            if ($.cookie("login_usr_role")) {
                $("#rolebox .roleSpan").removeClass("active").eq($.cookie("login_usr_role") - 1).addClass("active").prependTo($("#rolebox"));
                $("#mobileRole .roleSpan").removeClass("active").eq($.cookie("login_usr_role") - 1).addClass("active").prependTo($("#mobileRole"));
            };

            // document.getElementById("nowyear").innerHTML = new Date().getFullYear();

            bindEnterEvent();
            var loginToken = window.localStorage.getItem('cnki_login_token_cnki');
            var isLogin = false;
            if (!checkValIsUndefinedOrNull(loginToken)) {
                isLogin = ManyTimesUserLogin(loginToken);
            }
            if (!isLogin) {
                var sso = getUrlParam("sso");
                if (!checkValIsUndefinedOrNull(sso) || school_Init()) {

                    $.when(singleSignOn()).then(function (isContinue) {
                        if (!isContinue) {
                            return;
                        }
                        if (!checkValIsUndefinedOrNull(sso)) {
                            school_Init(); //单点登录失败后，重新加载学校数据
                        }
                        loadNotice();
                    });
                }
            }
        });
        var dp = '';
        if (isDP()) {// 如果有参数和cookie
            dp = isDP();// 如果有接收参数
            $("#resPwd").prop("href", "ResetPasswords.html?dp=" + dp + "");
        };
        $("#divNotice").click(function () {//点击公告判断是否有dp
            if (!isDP()) {
                window.location.href = 'Error.html';
                return
            };
        });
        // 微信登录和账号登录切换
        $(".switcher li").off().on("click", function () {
            $(".switcher li").removeClass("active");
            $(this).addClass("active");
            $(".longinBox .switch").hide().eq($(this).index()).show();
            if ($(this).index() == 1) {
                $.getScript("https://res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js", function () {  //加载test.js,成功后，并执行回调函数
                    var domain = window.location.origin
                    if (getUrlIsMultistage()) {
                        domain += '/' + getUrlIsMultistage()
                    }
                    var dp = '';
                    if (isDP()) {
                        dp = isDP();
                    };
                    var queryStr = encodeURIComponent(JSON.stringify({
                        'domain': '' + domain,
                        'type': '1',
                        'dp': '' + dp
                    }));
                    new WxLogin({
                        self_redirect: true,
                        id: "login_QRcode",
                        appid: "wx2c4e52b77c39e391",
                        scope: "snsapi_login",
                        //expires_in: "100",
                        //redirect_uri:encodeURI("http://" + url + "/Handler/WechatLoginHandler.ashx"),
                        //redirect_uri: encodeURI("http://" + url + "/Login.html"),
                        redirect_uri: encodeURI("https://co.cnki.net/WeChat/WeChatBinding.html?doMainStr=" + queryStr),
                        state: "1",
                        style: "",
                        href: ""
                    });
                });
            }
        });
        // 切换账号密码登录
        $("#switchToWrite").off().on('click', function () {
            $(".switcher li").removeClass("active").eq(0).addClass("active");
            $(".longinBox .switch").hide().eq(0).show();
        });
        function closeMeetingRemindBox () {
            $("#meetingRemindBox").hide();
        }

        // 免登陆验证
        function ManyTimesUserLogin (token) {
            var rs = false;
            $.ajax({
                url: baseUrl + "Handler/LoginHandler.ashx?action=ManyTimesUserLogin",
                data: { "loggingToken": token },
                dataType: "json",
                type: "POST",
                async: false,
                beforeSend: function () {
                    $('#login').val('登录中...');
                    $('#login').prop('disabled', 'disabled');
                    $("#loginLoddingBox").show();
                },
                success: function (data) {
                    if (data.isSuccess) {
                        rs = true;
                        if (data.errorCode == 980) {
                            if (data.dataList && data.dataList.loginState == -6) {
                                if (data.dataList.canBindWechat && data.dataList.canBindEmail) {//微信 + 邮箱 2 =》 优先微信 1
                                    window.location = 'LoginAuthentication.html?authentication=1&dp=' + dp;
                                } else if (data.dataList.canBindWechat && !data.dataList.canBindEmail) {//微信
                                    window.location = 'LoginAuthentication.html?authentication=1&dp=' + dp;
                                } else if (!data.dataList.canBindWechat && data.dataList.canBindEmail) { // 邮箱
                                    window.location = 'LoginAuthentication.html?authentication=0&dp=' + dp;
                                } else {
                                    FirstLogin(data.dataList.role);
                                }
                            } else {
                                window.location = 'PhoneBinding.html?dp=' + dp;
                            }
                            $('#login').val('登录');
                            $('#login').prop('disabled', false);
                            load_checkcode();
                        } else if (data.errorCode == -1) {
                            window.localStorage.setItem('cnki_login_token_cnki', data.dataList.loginToken);
                            FirstLogin(data.dataList.role);
                        }
                    } else {
                        $('#login').val('登录');
                        $('#login').prop('disabled', false);
                        load_checkcode();
                    }
                },
                error: function (err) {
                    console.log(err);
                },
                complete: function () {
                    $('#login').val('登录');
                    $('#login').prop('disabled', false);
                    $("#loginLoddingBox").hide();
                }
            })
            return rs;
        };

        function meetingLiveCopy () {
            try {
                var clipboard = new Clipboard('#meetingLiveTxt', {
                    text: function (trigger) {
                        return trigger.getAttribute('data-text');
                    }
                });
                clipboard.on('success', function (e) {
                    showCopyTips(e.trigger);
                });
                clipboard.on('error', function (e) {
                    if (console && console.error) {
                        console.error(e);
                    };
                });
            } catch (ex) {
                if (console && console.log) {
                    console.log(ex);
                };
                try {
                    var ua = window.navigator.userAgent;
                    var is_IE = ua.match(/(rv:|msie )\d+/i);
                    var IE_Version = is_IE ? parseInt(is_IE[0].split(/:| /g)[1]) : 9;
                    if (IE_Version <= 8 && window.clipboardData) { //IE8
                        $("#meetingLiveTxt").on('click',
                            function () {
                                var text = $(this).getAttribute('data-text');
                                window.clipboardData.setData('Text', text);
                                showCopyTips(this);
                            });
                    } else {
                        myMessage("浏览器版本过低，不支持自动复制功能，请手动复制！");
                    };
                } catch (ex_ie) {
                    if (console && console.error) {
                        console.error(ex_ie);
                    };
                };
            };
        };

        //提示已复制
        function showCopyTips (element) {
            var span = $(element).siblings(".copyTips");
            if (span && span.length > 0) {
                $(span).show();
            } else {
                $(element).parent().append('<span class="copyTips">已复制</span>');
            };
            setTimeout(function time () {
                $(element).siblings(".copyTips").hide(1000);
            }, 1000);
        };

        // 判断是否为移动端
        function isMobile () {
            var userAgentInfo = navigator.userAgent;
            var mobileAgents = ["Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod"];
            var mobile_flag = false;
            //根据userAgent判断是否是手机
            for (var v = 0; v < mobileAgents.length; v++) {
                if (userAgentInfo.indexOf(mobileAgents[v]) > 0) {
                    mobile_flag = true;
                    break;
                }
            }
            var screen_width = $(window).width();
            //根据屏幕分辨率判断是否是手机
            if (screen_width < 900) {
                mobile_flag = true;
            }
            return mobile_flag;
        };

        $(window).resize(function () {
            var mobile_flag = isMobile();
            if (mobile_flag) {
                $("#mobileShow").show();
                $("#pcShow").hide();
            } else {
                $("#pcShow").show();
                $("#mobileShow").hide();
            }
        });

        // 关闭弹窗
        function closeBrowserTips () {
            document.querySelector('#brower').style.display = 'none';
            window.localStorage.setItem("closebrowsertips", ($("#notTips").is(":checked") ? 1 : 0));
        };

        /**
         * 1判断有无优秀论文
         */
        function hasExcellentThesis () {
            var xhr = $.ajax({
                url: baseUrl + "Handler/ExcellentThesisLoginHandler.ashx",
                data: { "type": "1" },
                dataType: "json",
                type: "POST"
            })
            return xhr;
        };

        /**
         * 2获取公告类型
         * @param {boolean} hasThesis 有无优秀论文
         */
        function getNoticeType (hasThesis) {
            var xhr = $.ajax({
                url: baseUrl + "Handler/NoticesLoginHandler.ashx",
                data: { "type": "1" },
                dataType: "json",
                type: "POST"
            });
            return xhr;
        };

        /**
         * 3加载公告列表
         * @param id
         * @param strCss
         * @param noticeName
         */
        function getNoticeList (id, strCss) {
            var xhr = $.ajax({
                url: baseUrl + "Handler/NoticesLoginHandler.ashx",
                data: { "type": "2", "ID": id },
                //async: false,
                dataType: "json",
                type: "POST"
            }).done(function (data) {
                var mobileHtml = ''
                var str = "";
                if (data && data.isSuccess && data.rows && data.rows.length > 0) {
                    $.each(data.rows, function (index, item) {
                        var mingcheng = item['标题'];
                        if (strCss === "double" && mingcheng.length > 20) {
                            mingcheng = mingcheng.substring(0, 20) + "....";
                        };
                        if (strCss === "singleton" && mingcheng.length > 50) {
                            mingcheng = mingcheng.substring(0, 50) + "....";
                        };
                        str += "<li><a class='inform' href='Details.html?dp=" + dp + "&noticeId=" + item.ID + "&typeId=" + id + "' title='" + mingcheng
                            + "' target='_blank'>" + mingcheng + "</a><span>" + dateFormat(item['创建时间'], "yyyy-MM-dd") + "</span></li>";
                        mobileHtml += '<li><a href="Details.html?dp=' + dp + '&noticeId=' + item.ID + '&typeId=' + id + '" title="' + mingcheng
                            + '" target="_blank">' + ((mingcheng && mingcheng.length > 10) ? (mingcheng.substring(0, 15) + "....") : mingcheng)
                            + '</a><span>' + dateFormat(item['创建时间'], "yyyy-MM-dd") + '</span></li>';
                    });
                } else {
                    mobileHtml += "<li style='border: none;color: #636262'>该公告类型下暂未发布公告内容</li></ul></div>";
                    str += "<li style='border: none;color: #636262'>该公告类型下暂未发布公告内容</li></ul></div>";
                };
                $("#div_notice_" + id).html(str);
                $("#mobile_notice_" + id).html(mobileHtml);
            });
            return xhr;
        };

        /**
         * 加载优秀论文
         */
        function getExcellentThesisList (strCss) {
            $.ajax({
                url: baseUrl + "Handler/ExcellentThesisLoginHandler.ashx",
                data: { "type": "2" },
                dataType: "json",
                type: "POST"
            }).done(function (data) {
                var str = "<div id='divnoticeExcelThesis' class='design " + strCss + "'><h2>优秀论文展示" +
                    "<a href='Notice.html?typeId=-1&dp=" + dp + "' target='_blank'>More>></a></h2><ul class='articlelist clearfix'>";
                var mobileHtml = '<div class="notice"><h3>优秀论文展示<a href="Notice.html?typeId=-1&dp=' + dp + '">More>></a></h3><ul>'
                if (data && data.isSuccess && data.rows && data.rows.length > 0) {
                    $.each(data.rows, function (index, item) {
                        var mingcheng = item['名称'];
                        if (strCss === "double" && mingcheng.length > 20) {
                            mingcheng = mingcheng.substring(0, 20) + "....";
                        };
                        if (strCss === "singleton" && mingcheng.length > 50) {
                            mingcheng = mingcheng.substring(0, 50) + "....";
                        };
                        str += "<li><a class=\"inform\" href=\"Details.html?flag=1&dp=" + dp + "&SID=" + item['SID'] + "&proid=" + item['课题编号']
                            + "\" title=\"" + mingcheng + "\" target=\"_blank\">"
                            + mingcheng + "</a><span>" + dateFormat(item['创建时间'], "yyyy-MM-dd") + "</span></li>";
                        mobileHtml += '<li><a href="Details.html?flag=1&SID=' + item['SID'] + '&proid=' + item['课题编号'] + '" title="' + mingcheng
                            + '" target="_blank">' + ((mingcheng && mingcheng.length > 10) ? (mingcheng.substring(0, 10) + "...") : mingcheng)
                            + '</a><span>' + dateFormat(item['创建时间'], "yyyy-MM-dd") + '</span></li>';
                    });
                } else {
                    mobileHtml += "<li style='border: none;color: #636262'>暂无优秀论文</li>";
                    str += "<li style='border: none;color: #636262'>暂无优秀论文</li>";
                }
                str += "</ul></div>";
                mobileHtml += "</ul></div>";
                $("#divNotice").append(str);
                $("#mobileNotice").append(mobileHtml);
            }).fail(function (err) {
                console.log(err);
            });
        };

        /**
         * 加载登录页上的通知通告和优秀论文
         */
        function loadNotice () {
            $.when(hasExcellentThesis()).then(function (hasExe) {
                getNoticeType().done(function (data) {
                    $("#divNotice,#mobileNotice").empty();
                    var num = (data && data.isSuccess && data.rows && data.rows.length > 0) ? data.rows.length : 0;
                    if (hasExe && hasExe.isSuccess) {
                        num++
                    }
                    var strCss = "";
                    if (num % 2 == 0) {
                        strCss = "double";
                    } else {
                        strCss = "singleton";
                    };
                    if (data && data.isSuccess && data.rows && data.rows.length > 0) {
                        var xhrNotice;
                        $.each(data.rows, function (index, item) {
                            var str = "<div  class='" + strCss + "'><h2>" + item['名称']
                                + "<a href='Notice.html?dp=" + dp + "&typeId=" + item['ID'] + "' target='_blank'>More>></a></h2>"
                                + "<ul id='div_notice_" + item['ID'] + "' class='articlelist clearfix'></ul></div>";
                            //' + ((noticeName && noticeName.length > 10) ? (noticeName.substring(0, 10) + '...') : noticeName) + '
                            var mobileHtml = "<div class='notice'><h3>" + item['名称'] + "<a href='Notice.html?dp=" + dp + "&typeId=" + item['ID'] + "'>More>></a></h3>"
                                + "<ul id='mobile_notice_" + item['ID'] + "'></ul></div > ";
                            $("#divNotice").append(str);
                            $("#mobileNotice").append(mobileHtml);
                            getNoticeList(item['ID'], strCss);
                        });
                    }
                    if (hasExe && hasExe.isSuccess) {
                        getExcellentThesisList(strCss)
                    }
                }).fail(function (err) {
                    if (console && console.error) {
                        console.error(err);
                    };
                });
            });
        };

        //绑定回车事件
        function bindEnterEvent () {
            $(document).keyup(function (e) {
                var eCode = e.keyCode ? e.keyCode : e.which ? e.which : e.charCode;
                if (eCode == 13) {
                    if ($('#write').is(':visible') && $("#LoginMessageTipsbox").length <= 0) {
                        login_click();
                    } else {
                        return;
                    };
                };
            });
        };

        /**
         * 单点登录
         */
        function singleSignOn () {
            var dtd = $.Deferred(); //在函数内部，新建一个Deferred对象
            var sso = getUrlParam("sso");
            var ssoType = getUrlParam("type");
            if (checkValIsUndefinedOrNull(ssoType)) {
                ssoType = 1;
            }
            if (checkValIsUndefinedOrNull(sso)) {
                dtd.resolve(true);
            } else {
                $.ajax({
                    url: baseUrl + "Handler/LoginHandler.ashx?action=SingleSignOn",
                    type: "POST",
                    data: {
                        sso: sso,
                        type: ssoType
                    },
                    dataType: "json"
                }).done(function (data) {
                    if (data.isSuccess) {
                        var LoginRole = 0;
                        if (data.dataList.roleType == 2) {
                            LoginRole = 3
                        } else if (data.dataList.roleType == 1) {
                            LoginRole = 1
                        } else {
                            LoginRole = 2
                        }
                        $.cookie("login_usr_role", LoginRole, { expires: 30 });//记录下用户的角色
                        if (data.errorCode == 980) {
                            if (data.dataList && data.dataList.loginState == -6) {
                                if (data.dataList.canBindWechat && data.dataList.canBindEmail) {//微信 + 邮箱 2 =》 优先微信 1
                                    window.location = 'LoginAuthentication.html?authentication=1&dp=' + dp;
                                } else if (data.dataList.canBindWechat && !data.dataList.canBindEmail) {//微信
                                    window.location = 'LoginAuthentication.html?authentication=1&dp=' + dp;
                                } else if (!data.dataList.canBindWechat && data.dataList.canBindEmail) { // 邮箱
                                    window.location = 'LoginAuthentication.html?authentication=0&dp=' + dp;
                                } else {
                                    FirstLogin(LoginRole);
                                }
                            } else {
                                window.location = 'PhoneBinding.html?dp=' + dp;
                            }
                        } else {
                            FirstLogin(LoginRole);
                            //window.location = "Role.html?r=" + (+new Date());
                        }
                        dtd.resolve(false);
                    } else if (!checkValIsUndefinedOrNull(data.message)) {
                        LoginMessage(data.message);
                        dtd.resolve(true);
                    }
                }).fail(function (err) {
                    if (console && console.error) {
                        console.error(err);
                    }
                    dtd.resolve(true);
                });
            }
            return dtd.promise();
        }

        //判断ie7以下
        function IEVersion () {
            var userAgent = navigator.userAgent; //取得浏览器的userAgent字符串
            var isIE = userAgent.indexOf("compatible") > -1 && userAgent.indexOf("MSIE") > -1; //判断是否IE<11浏览器
            var isEdge = userAgent.indexOf("Edge") > -1 && !isIE; //判断是否IE的Edge浏览器
            var isIE11 = userAgent.indexOf('Trident') > -1 && userAgent.indexOf("rv:11.0") > -1;
            if (isIE) {
                var reIE = new RegExp("MSIE (\\d+\\.\\d+);");
                reIE.test(userAgent);
                var fIEVersion = parseFloat(RegExp["$1"]);
                if (fIEVersion == 7) {
                    return 7;
                } else if (fIEVersion == 8) {
                    return 8;
                } else if (fIEVersion == 9) {
                    return 9;
                } else if (fIEVersion == 10) {
                    return 10;
                } else {
                    return 6;//IE版本<=7
                };
            } else if (isEdge) {
                return 'edge';//edge
            } else if (isIE11) {
                return 11; //IE11
            } else {
                return -1;//不是ie浏览器
            };
        };

        //判断浏览器类型
        function checkBrowser () {
            var ua = navigator.userAgent.toLocaleLowerCase();
            var browserType = null;
            if (ua.match(/msie/) != null || ua.match(/trident/) != null) {
                browserType = "IE";
                //browserVersion = ua.match(/msie ([\d.]+)/) != null ? ua.match(/msie ([\d.]+)/)[1] : ua.match(/rv:([\d.]+)/)[1];
            } else if (ua.match(/edge/) != null) {
                browserType = "Edge";
            } else if (ua.match(/firefox/) != null) {
                browserType = "火狐";
            } else if (ua.match(/ubrowser/) != null) {
                browserType = "UC";
            } else if (ua.match(/opr/) != null) {
                browserType = "欧朋";
            } else if (ua.match(/bidubrowser/) != null) {
                browserType = "百度";
            } else if (ua.match(/metasr/) != null) {
                browserType = "搜狗";
            } else if (ua.match(/tencenttraveler/) != null || ua.match(/qqbrowse/) != null) {
                browserType = "QQ";
            } else if (ua.match(/maxthon/) != null) {
                browserType = "遨游";
            } else if (ua.match(/chrome/) != null) {
                var is360 = _mime("type", "application/vnd.chromium.remoting-viewer");
                function _mime (option, value) {
                    var mimeTypes = navigator.mimeTypes;
                    for (var mt in mimeTypes) {
                        if (mimeTypes[mt][option] == value) {
                            return true;
                        }
                    }
                    return false;
                }
                if (is360) {
                    browserType = '360';
                } else {
                    browserType = "谷歌";
                }
            } else if (ua.match(/safari/) != null) {
                browserType = "Safari";
            }
            return browserType;
        };

        $("#switchPC").off("click").on("click", function () {
            $("#pcShow").show();
            $("#mobileShow").hide();
        });

        // 显示公众号二维码
        $(".notifications").off("mouseover").on("mouseover", function () {
            $(".weixindigg").stop().slideDown();
        });
        // 隐藏公众号二维码
        $(".notifications").off("mouseleave").on("mouseleave", function () {
            $(".weixindigg").stop().slideUp();
        });

        $("#getPhoneCode,#getmobilePhoneCode").off("click").on("click", function () {
            if ($("#getPhoneCode").hasClass('disable')) {
                return
            } else {
                if ($(this).attr('id') == 'getmobilePhoneCode') {
                    sendPhoneCode(1);
                } else {
                    sendPhoneCode(0);
                }
            }
        });
    </script>
    <script type="text/javascript" src="https://kycximage.cnki.net/kycx.notice/2012/co1.js"></script>
    <script type="text/javascript" src="https://kycximage.cnki.net/kycx.notice/2012/co2.js"></script>
    <script type="text/javascript" src="https://kycximage.cnki.net/kycx.notice/2012/co3.js"></script>
    <!--<script type="text/javascript" src="./reportLink/reportLink.js"></script>-->
</body>
</html>